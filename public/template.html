<div class="loading" ng-if="!posts.length">
  <img src="images/loading.gif">
</div>
<div class="row" ng-if="posts.length">
  <table class="posts">
    <tr class="post" ng-repeat="post in posts">
      <td class="aright">{{post.score}}</td>
      <td class="full">
        <div class="title"><a ng-href="{{post.url}}" target="_blank">{{post.title}}</a></div>
        <div class="info"><a ng-href="/#{{post.permalink}}">{{post.num_comments}} Comments</a> | {{post.created_utc | timeago}} by {{post.author}}</div>
      </td>
    </tr>
  </table>
  <div class="selftext" ng-if="comments.length" ng-bind-html="parseHtml(posts[0].selftext_html)"></div>
  <div class="comments" ng-if="comments.length" ng-include="'tree_comment.html'" ng-class="{noSelfText: !posts[0].selftext_html.length}"></div>
</div>

<script type="text/ng-template"  id="tree_comment.html">
  <div class="comment" ng-repeat="comment in comments" ng-init="show = true">
    <div class="title">
      <a ng-click="show = !show">[{{show && '&ndash;' || '+'}}]</a>
      <span ng-class="{'is-author': posts[0].author === comment.author}">{{comment.author}}</span> &bull;
      {{comment.score}} point{{comment.score !== 1 && 's' || ''}} &bull;
      {{comment.created_utc | timeago}}
    </div>
    <div class="description" ng-bind-html="parseHtml(comment.body_html)" ng-show="show"></div>
    <a ng-if="comment.more" ng-show="show" ng-click="comment.more = false">Load more comments...</a>
    <div ng-include="'tree_comment.html'" ng-if="comment.replies.length && !comment.more" ng-show="show" ng-init="comments = comment.replies"></div>
  </div>
</script>

